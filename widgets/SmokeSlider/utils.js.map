{"version":3,"sources":["../../../widgets/SmokeSlider/utils.js"],"names":["define","html","domGeometry","array","esriTimeInfo","jimuUtils","TimeExtent","store","moment","mo","intervalUnitOptions","window","jimuNls","timeUnit","year","UNIT_YEARS","month","UNIT_MONTHS","week","UNIT_WEEKS","day","UNIT_DAYS","hour","UNIT_HOURS","minute","UNIT_MINUTES","second","UNIT_SECONDS","milliSecond","UNIT_MILLISECONDS","isLayerEnabledTime","layer","layerInfosObj","layerInfo","getLayerInfoById","id","layerObjet","layerObject","isTimeEnabled","timeInfo","timeExtent","usesTime","originLayer","originOperLayer","itemProperties","timeAnimation","setLayersUseMapTimebyConfig","config","configLayers","customLayersConfig","infos","getLayerInfoArray","i","len","length","configLayer","j","lenJ","info","setUseMapTime","isTimeEnable","initPositionForTheme","bottom","isRunInMobile","appInfo","isOutOfScreen","map","position","containerBox","getMarginBox","root","mapWidth","w","mapHeight","h","top","left","_MINIMODE_HEIGHT","getMarginPosition","domNode","sliderContentBox","getContentBox","marginPosition","right","setMarginPosition","setStyle","initPosition","appConfig","getAppConfig","theme","name","getInitTop","getInitLeft","popupHeight","marginBottom","middleOfScreenWidth","middleOfPopupWidth","isValidDate","date","Date","isNaN","getTime","isValidDataStrByDateLocale","dataStr","hasLiveData","useMapTime","getCalendarTime","customTimeConfig","refTime","time","timeMode","tempTime","getFullYear","getMonth","getDate","calendar","calender","unit","number","operator","cu","indexOf","res","split","console","log","add","valueOf","subtract","isConfigLiveMode","startTime","endTime","isCustomTime","isHonorWebMap","timeConfig","isLiveTimeMode","mode","timeCalendarForBuilderConfig","strtTime","interval","thumbCount","displayAllData","getFullTimeExtent","timeExtents","noRound","fullTimeExtent","forEach","te","roundTime","getHours","getMinutes","getAutoRefreshTime","SECONDS","MINUTES","HOURS","DAYS","autoRefresh","isAutoRefresh","toUpperCase","getKey","widgetId","prefix","appId","encodeURIComponent","getAppIdFromUrl","getCacheByKeys","cache","get","saveToLocalCache","stops","removeLocalCache","set","obj","remove"],"mappings":"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","file":"utils.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\n// Copyright Â© Esri. All Rights Reserved.\n//\n// Licensed under the Apache License Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n///////////////////////////////////////////////////////////////////////////\n\ndefine(['dojo/_base/html', 'dojo/dom-geometry', 'dojo/_base/array',\n  \"esri/layers/TimeInfo\", 'jimu/utils', 'esri/TimeExtent', 'libs/storejs/store', 'moment/moment'],\n  function (html, domGeometry, array, esriTimeInfo, jimuUtils, TimeExtent, store, moment) {\n\n    var mo = {};\n\n    mo.intervalUnitOptions = [{\n      \"label\": window.jimuNls.timeUnit.year,\n      \"value\": esriTimeInfo.UNIT_YEARS\n    }, {\n      \"label\": window.jimuNls.timeUnit.month,\n      \"value\": esriTimeInfo.UNIT_MONTHS\n    }, {\n      \"label\": window.jimuNls.timeUnit.week,\n      \"value\": esriTimeInfo.UNIT_WEEKS\n    }, {\n      \"label\": window.jimuNls.timeUnit.day,\n      \"value\": esriTimeInfo.UNIT_DAYS\n    }, {\n      \"label\": window.jimuNls.timeUnit.hour,\n      \"value\": esriTimeInfo.UNIT_HOURS\n    }, {\n      \"label\": window.jimuNls.timeUnit.minute,\n      \"value\": esriTimeInfo.UNIT_MINUTES\n    }, {\n      \"label\": window.jimuNls.timeUnit.second,\n      \"value\": esriTimeInfo.UNIT_SECONDS\n    }, {\n      \"label\": window.jimuNls.timeUnit.milliSecond,\n      \"value\": esriTimeInfo.UNIT_MILLISECONDS\n    }];\n\n    mo.isLayerEnabledTime = function (layer, layerInfosObj, layerInfo) {\n      if (!layerInfo) {\n        layerInfo = layerInfosObj.getLayerInfoById(layer.id);\n      }\n\n      if (!layerInfo) {\n        return;\n      }\n      var layerObjet = layerInfo.layerObject;\n      var isTimeEnabled = layerObjet.timeInfo && layerObjet.timeInfo.timeExtent; //&& !parameterList.layer.timeInfo.hasLiveData;\n      //var hasLiveData = layerObjet.timeInfo && layerObjet.timeInfo.hasLiveData;\n      var usesTime = true;\n\n      var originLayer = layerInfo.originOperLayer;\n      if (originLayer.itemProperties && \"undefined\" !== typeof originLayer.itemProperties.timeAnimation) {\n        usesTime = false;// arcgis-portal-app-master\\src\\js\\arcgisonline\\map\\itemData.js Line#205\n      }\n      if (false === originLayer.timeAnimation) {\n        usesTime = false;\n      }\n      if (true === originLayer.timeAnimation) {\n        usesTime = true;\n      }\n      if ((originLayer.itemProperties && \"undefined\" !== typeof originLayer.itemProperties.timeAnimation) &&\n        \"undefined\" !== typeof originLayer.timeAnimation) {\n        usesTime = true;\n      }\n\n      //var hasLiveData = layerObjet.timeInfo && layerObjet.timeInfo.hasLiveData;\n      // var originLayer = layerInfo.originOperLayer;\n      // //1- Does the webmap contain a timeAnimation property, then do whatever it says.\n      // if (originLayer.itemProperties) {\n      //   usesTime = originLayer.timeAnimation;\n      // } else {\n      //   //2- If the webmap does not contain a timeAnimation property, check if the layer has an itemId.\n      //   if (\"undefined\" === typeof originLayer.itemProperties) {\n      //     //2.1\titemId does not exist then check hasLiveData on the service. If hasLiveData is true then do not show the time slider. Otherwise show time slider.\n      //     usesTime = hasLiveData;\n      //   } else {\n      //     //2.2\titemId does exist then check the item /data object. If it contains a timeAnimation property for the layer do whatever it says. If it does not contain timeAnimation then check hasLiveData and follow the rule from above.\n      //     if (\"undefined\" !== typeof originLayer.itemProperties.timeAnimation) {\n      //       usesTime = originLayer.itemProperties.timeAnimation;\n      //     } else {\n      //       usesTime = hasLiveData;\n      //     }\n      //   }\n      // }\n      return !!(usesTime && isTimeEnabled);\n    };\n\n    mo.setLayersUseMapTimebyConfig = function (layerInfosObj, config) {\n      var configLayers = config.customLayersConfig;\n      var infos = layerInfosObj.getLayerInfoArray();\n\n      for (var i = 0, len = configLayers.length; i < len; i++) {\n        var configLayer = configLayers[i];\n\n        for (var j = 0, lenJ = infos.length; j < lenJ; j++) {\n          var info = infos[j];\n          if (configLayer.id === info.id && info.layerObject.setUseMapTime) {\n\n            if (true === configLayer.isTimeEnable) {\n              info.layerObject.setUseMapTime(true);\n            } else {\n              info.layerObject.setUseMapTime(false);\n            }\n          }\n        }\n      }\n    };\n\n    mo.initPositionForTheme = {\n      \"DartTheme\": {\n        bottom: 140\n      },\n      'LaunchpadTheme': {\n        bottom: 120\n      }\n    };\n\n    mo.isRunInMobile = function () {\n      return window.appInfo.isRunInMobile;\n    };\n    mo.isOutOfScreen = function (map, position) {\n      var containerBox = domGeometry.getMarginBox(map.root);\n      var mapWidth = containerBox.w;\n      var mapHeight = containerBox.h;\n\n      if (position &&\n        (position.top >= mapHeight || position.left >= mapWidth)) {\n\n        return true;\n      } else {\n        return false;\n      }\n    };\n    mo._MINIMODE_HEIGHT = 35;//height of popup\n    mo.getMarginPosition = function (map, domNode, position){\n      var containerBox = domGeometry.getMarginBox(map.root);\n      var mapWidth = containerBox.w;\n      var mapHeight = containerBox.h;\n      var sliderContentBox = html.getContentBox(domNode);\n\n      position.marginPosition = {\n        right: mapWidth - (sliderContentBox.w + position.left),\n        bottom: mapHeight - (mo._MINIMODE_HEIGHT/*sliderContentBox.h*/ + position.top)\n        //right: (mapWidth - (sliderContentBox.w + position.left)) / mapWidth,\n        //bottom: (mapHeight - (mo._MINIMODE_HEIGHT/*sliderContentBox.h*/ + position.top)) / mapHeight\n      };\n    };\n    mo.setMarginPosition = function (map, domNode, position){\n      if (position.marginPosition) {\n        var containerBox = domGeometry.getMarginBox(map.root);\n        var mapWidth = containerBox.w;\n        var mapHeight = containerBox.h;\n        var sliderContentBox = html.getContentBox(domNode);\n        position.top = mapHeight - (mo._MINIMODE_HEIGHT/*sliderContentBox.h*/ + position.marginPosition.bottom);\n        position.left = mapWidth - (sliderContentBox.w + position.marginPosition.right);\n        //position.top = mapHeight - (position.marginPosition.bottom*mapWidth + mo._MINIMODE_HEIGHT);\n        //position.left = mapWidth - (position.marginPosition.right*mapHeight + sliderContentBox.w);\n        if (position.top < 0) {\n          position.top = 0;\n        }\n        if (position.left < 0) {\n          position.left = 0;\n        }\n      }\n\n      html.setStyle(domNode, 'top', position.top + 'px');\n      html.setStyle(domNode, 'left', position.left + 'px');\n    };\n    mo.initPosition = function (map, domNode, position) {\n      var appConfig = window.getAppConfig();\n      var theme;\n      if (appConfig && appConfig.theme && appConfig.theme.name) {\n        theme = appConfig.theme.name;\n      }\n\n      var top = mo.getInitTop(map, theme);\n      var left = mo.getInitLeft(map, domNode);\n      position.top = top;\n      position.left = left;\n      html.setStyle(domNode, 'top', position.top + 'px');\n      html.setStyle(domNode, 'left', position.left + 'px');\n    };\n    mo.getInitTop = function (map,/*domNode,*/theme) {\n      var top = 0;\n      var containerBox = domGeometry.getMarginBox(map.root);\n      // var sliderContentBox = html.getContentBox(domNode);\n      // var popupHeight = sliderContentBox.h;\n      var popupHeight = mo._MINIMODE_HEIGHT;//height of mini mode\n\n      var marginBottom = mo.initPositionForTheme[theme] ? mo.initPositionForTheme[theme].bottom : 60;\n      top = containerBox.h - marginBottom - popupHeight;\n\n      return top;\n    };\n    mo.getInitLeft = function (map, domNode/*, theme*/) {\n      var left = 0;\n      var containerBox = domGeometry.getMarginBox(map.root);\n      var sliderContentBox = html.getContentBox(domNode);\n\n      var middleOfScreenWidth = containerBox.w / 2;\n      var middleOfPopupWidth = sliderContentBox.w / 2;\n      left = middleOfScreenWidth - middleOfPopupWidth;\n\n      return left;\n    };\n\n    mo.isValidDate = function (date) {\n      return date instanceof Date && !isNaN(date.getTime());\n    };\n    mo.isValidDataStrByDateLocale = function(dataStr){\n      if (\"undefined NaN, NaN\" === dataStr) {\n        return false;\n      }\n\n      return true;\n    };\n\n    mo.hasLiveData = function (layer) {\n      // doesn't need to consider KMLLayers\n      return !!(layer && layer.useMapTime && layer.timeInfo && layer.timeInfo.hasLiveData);\n    };\n\n    mo.getCalendarTime = function (customTimeConfig, refTime) {\n      var time;\n      if (\"time\" === customTimeConfig.timeMode ||\n        \"min\" === customTimeConfig.timeMode || \"max\" === customTimeConfig.timeMode) {\n        //1 time mode\n        time = new Date(customTimeConfig.time);\n      } else if (\"now\" === customTimeConfig.timeMode || \"today\" === customTimeConfig.timeMode) {\n        //2 calendar mode\n        var tempTime = refTime ? new Date(refTime) : new Date();//use reference first\n\n        if (\"today\" === customTimeConfig.timeMode) {\n          time = new Date(tempTime.getFullYear(), tempTime.getMonth(), tempTime.getDate(), 0, 0, 0);// Date = Today Hour =0, Minute= 0, Second = 0\n        } else {//\"now\"\n          time = tempTime;\n        }\n\n        var calendar = customTimeConfig.calender;\n        var unit = \"\";\n        if (calendar && calendar.number && calendar.operator && calendar.unit) {\n          var cu = calendar.unit;\n          if (-1 !== cu.indexOf(\"esriTimeUnits\")) {\n            var res = cu.split(\"esriTimeUnits\");\n            if (res && res.length === 2) {\n              unit = res[1];\n            }\n          } else {\n            console.log(\"unsupported unit:\" + calendar.unit);\n            return new Date(time);\n          }\n\n          if (\"+\" === calendar.operator) {\n            time = moment(time).add(calendar.number, unit).valueOf();\n          } else if (\"-\" === calendar.operator) {\n            time = moment(time).subtract(calendar.number, unit).valueOf();\n          }\n          //moment().add(\"-10\", 'days').calendar();//\"Yesterday at 5:18 PM\"\n          //moment().add(1, 'd').format();//\"2018-05-04T17:17:07+08:00\"\n          //moment().add(1, 'd').valueOf();//1525425627984\n        }\n      }\n\n      return new Date(time);\n    };\n    mo.isConfigLiveMode = function (config) {\n      var startTime = false,\n        endTime = false;\n\n      var isCustomTime = (false === config.isHonorWebMap);\n\n      if (config && config.customTimeConfig && config.customTimeConfig.startTime &&\n        config.customTimeConfig.startTime.timeConfig && config.customTimeConfig.startTime.timeConfig.timeMode) {\n        startTime = mo.isLiveTimeMode(config.customTimeConfig.startTime.timeConfig.timeMode);\n      }\n      if (config && config.customTimeConfig && config.customTimeConfig.endTime &&\n        config.customTimeConfig.endTime.timeConfig && config.customTimeConfig.endTime.timeConfig.timeMode) {\n        endTime = mo.isLiveTimeMode(config.customTimeConfig.endTime.timeConfig.timeMode);\n      }\n\n      return isCustomTime && (startTime || endTime);\n    };\n    mo.isLiveTimeMode = function (mode) {\n      if (mode &&\n        (\"now\" === mode || \"today\" === mode || \"max\" === mode || \"min\" === mode)) {\n        return true;\n      }\n\n      return false;\n    };\n    mo.timeCalendarForBuilderConfig = function (config) {\n      if (false === config.isHonorWebMap) {\n        //custom layers & custom time\n        var strtTime, endTime, interval, thumbCount;\n\n        var refTime = new Date();\n        strtTime = mo.getCalendarTime(config.customTimeConfig.startTime.timeConfig, refTime);\n        endTime = mo.getCalendarTime(config.customTimeConfig.endTime.timeConfig, refTime);\n\n        //TODO check start < endtime\n        //if (strtTime === endTime) {\n        //endTime = endTime.setMinutes(endTime.getMinutes() + 1);\n        //endTime = endTime.setSeconds(endTime.getSeconds() + 1);\n        //endTime = new Date(endTime);\n        //}\n\n        if (null !== config.customTimeConfig.interval) {\n          interval = config.customTimeConfig.interval;\n        } else {\n          interval = null;\n        }\n\n        if (true === config.customTimeConfig.displayAllData) {\n          thumbCount = 1;\n        } else {\n          thumbCount = 2;\n        }\n\n        return {\n          startTime: strtTime,\n          endTime: endTime,\n          interval: interval,\n          thumbCount: thumbCount\n        };\n      } else {\n        return null;\n      }\n    };\n\n    mo.getFullTimeExtent = function(timeExtents, noRound){\n      var fullTimeExtent = null;\n      array.forEach(timeExtents, function (te) {\n        if (!te) {\n          return;\n        }\n\n        if (!fullTimeExtent) {\n          fullTimeExtent = new TimeExtent(new Date(te.startTime.getTime()),\n            new Date(te.endTime.getTime()));\n        } else {\n          if (fullTimeExtent.startTime > te.startTime) {\n            fullTimeExtent.startTime = new Date(te.startTime.getTime());\n          }\n          if (fullTimeExtent.endTime < te.endTime) {\n            fullTimeExtent.endTime = new Date(te.endTime.getTime());\n          }\n        }\n      });\n\n      //round off seconds\n      //mapViewer round the Minutes by default. but in timeCalendar setting, we don't want to round it\n      var roundTime = 1;\n      if (true === noRound) {\n        roundTime = 0;\n      }\n\n      fullTimeExtent.startTime = new Date(fullTimeExtent.startTime.getFullYear(),\n        fullTimeExtent.startTime.getMonth(), fullTimeExtent.startTime.getDate(),\n        fullTimeExtent.startTime.getHours(), fullTimeExtent.startTime.getMinutes(), 0, 0);\n      fullTimeExtent.endTime = new Date(fullTimeExtent.endTime.getFullYear(),\n        fullTimeExtent.endTime.getMonth(), fullTimeExtent.endTime.getDate(),\n        fullTimeExtent.endTime.getHours(), fullTimeExtent.endTime.getMinutes() + roundTime, 0, 0);\n\n      return fullTimeExtent;\n    };\n\n    mo.getAutoRefreshTime = function (config) {\n      var time = 0, unit = \"\";\n\n      var SECONDS = 1;\n      var MINUTES = SECONDS * 60;\n      var HOURS = MINUTES * 60;\n      var DAYS = HOURS * 24;\n\n      if (config && config.autoRefresh && true === config.autoRefresh.isAutoRefresh &&\n        config.autoRefresh.interval && config.autoRefresh.unit) {\n\n        var cu = config.autoRefresh.unit;\n        if (-1 !== cu.indexOf(\"esriTimeUnits\")) {\n          var res = cu.split(\"esriTimeUnits\");\n          if (res && res.length === 2) {\n            unit = res[1];\n          }\n        }\n\n        unit = unit.toUpperCase();\n\n        if (\"SECONDS\" === unit) {\n          time = config.autoRefresh.interval;\n        } else if (\"MINUTES\" === unit) {\n          time = config.autoRefresh.interval * MINUTES;\n        } else if (\"HOURS\" === unit) {\n          time = config.autoRefresh.interval * HOURS;\n        } else if (\"DAYS\" === unit) {\n          time = config.autoRefresh.interval * DAYS;\n        }\n      }\n\n      return time * 1000;\n    };\n\n    //store\n    mo.getKey = function (widgetId) {\n      var prefix = \"TimeSlider\";\n      var appId = encodeURIComponent(jimuUtils.getAppIdFromUrl());\n      return prefix + \".\" + appId + \".\" + widgetId;\n    };\n    mo.getCacheByKeys = function (widgetId) {\n      var cache = store.get(mo.getKey(widgetId));\n      return cache;\n    };\n    mo.saveToLocalCache = function (widgetId, stops) {\n      mo.removeLocalCache(widgetId);//clean\n      store.set(mo.getKey(widgetId), stops);//set indexs\n    };\n    mo.removeLocalCache = function (widgetId) {\n      var obj = mo.getCacheByKeys(widgetId);\n      if (obj) {\n        store.remove(mo.getKey(widgetId));\n      }\n    };\n    return mo;\n  });"]}